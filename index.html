<html>
<head>
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="style.css">
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>


</head>
<body>

<div id="map"></div>

<script>
//graph 1 ~ happiness
var width = 960,
    height = 500;
var projection = d3.geo.equirectangular();
var path = d3.geo.path().projection(projection);
var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);
var g = svg.append("g");
var worldObjects;
var countryIDName;
var happinessRank;
//get the id mappings json file
d3.json("id_mapping.json", function(dataID) {
	countryIDName = dataID;
	});
//get the happiness rankings
d3.json("happiness.json", function(happiness) {
	happinessRank = happiness;
	});
//function to return the name of the country based on the id.
function getCountryName(countryid){
	for(var i =0; i<countryIDName.length; i++ ){
		if(countryIDName[i].id == countryid){
			return countryIDName[i].name;
		}
	}
}
//function to return the id of the country based on the name
//Only used for debugging as of now
function getCountryID(countryName){
	for(var i =0; i<countryIDName.length; i++ ){
		if(countryIDName[i].name == countryName){
			return countryIDName[i].id;
		}
	}
}
//function to get the rank of the country basd on the country name
function getRank(countryName){
	var rank = 0;
	for(var i =0; i<happinessRank.length; i++ ){
		if(happinessRank[i].val1 == countryName){
			rank = happinessRank[i].val0;
		}
	}
	return rank;
}
//functions to convert colors based on country ranking
//make sure all functions return 0 (black) if the rank is 0 (undefined)
//maybe change from black to grey? Black is ugly
function red(rank) {
	if(rank==0){
		return 238;
	}else{
		return Math.round(255*(255*rank)/151);
	}
};
function green(rank){ 
	if (rank == 0){
		return 233;
	}else{
		return  Math.round((255*(151-rank))/151)};
	}
function blue(rank) {
	if (rank ==0 ){
		return 233;
	}else{
		return Math.round(0)
	}
};
var countryName = "";
//the magic
d3.json("world-50m.json", function(error, world) {
	worldObjects = world;
	if(error){console.log(error); }
	var countries = topojson.feature(world,world.objects.countries).features;
	countries.forEach(function (country) {
		countryName = getCountryName(country.id);
		rank = getRank(countryName);
		g.append("path").attr("d", path(country))
		.attr("class", "country")
		.style("fill", "rgb("+red(rank) +","+green(rank)+","+blue(rank)+")")
		;
	});
	//using for debugging purposes.. 
	//take out later
	g.selectAll("path").data(countries).on("mouseover", function(country){
		console.log(getCountryName(country.id));
	})
});
console.log("after json");

</script>

<script>
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
</script>


<div id="map2"></div>

<script>
//graph 2 ~ GDP
var width2 = 960,
    height2 = 500;
var projection2 = d3.geo.equirectangular();
var path2 = d3.geo.path().projection(projection2);
var svg2 = d3.select("#map2").append("svg")
    .attr("width", width2)
    .attr("height", height2);
var g2 = svg2.append("g");
var worldObjects2;
var gdpRank;


//get te gdp rankings
d3.json("gdp.json", function(gdp) {
	gdpRank = gdp;
})


//function to get the rank of the country basd on the country name
function getGdpRank(countryName){
	var rank = 0;
	for(var i =0; i<gdpRank.length; i++ ){
		if(gdpRank[i].val0 == countryName){
			rank = gdpRank[i].val1;
		}
	}
	return rank;
}

var countryName = "";
//the magic
d3.json("world-50m.json", function(error, world) {
	worldObjects2 = world;
	if(error){console.log(error); }
	var countries2 = topojson.feature(world,world.objects.countries).features;
	countries2.forEach(function (country) {
		countryName = getCountryName(country.id);
		rank2 = getGdpRank(countryName);
		g2.append("path").attr("d", path2(country))
		.attr("class", "country")
		.style("fill", "rgb("+red(rank2) +","+green(rank2)+","+blue(rank2)+")")
		;
	});
	//using for debugging purposes.. 
	//take out later
	g2.selectAll("path").data(countries2).on("mouseover", function(country){
		console.log(getCountryName(country.id));
	})
});
 </script>

<div id="scatterplot"></div>
<script>
//scatterplot : drug use of optimistic countries and pessimistic countries
var width3 = 1000,
    height3 = 700,
    xPadding3 = 60;
    yPadding3 = 50;
var svg3 = d3.select("#scatterplot").append("svg")
    .attr("width", width3)
    .attr("height", height3)
    .append("g");
var cannabisUsage;

function getCannabisUsage(countryName){
	var usage = 0;
	for(var i =0; i<200; i++ ){
		if(cannabisUsage[i].val0 == countryName){
			usage = cannabisUsage[i].val1;
		}
	}
	return usage;
}

//Y axis for how drugged they are
//X axis for optimism. Above 0 : opimitistic. Below 0 : pessimistic
var xScale4 = d3.scale.linear().domain([-150,150]).range([xPadding3, width3 - xPadding3]);
var yScale4 = d3.scale.linear().domain([0,20]).range([height3 - yPadding3, yPadding3]);
var xAxis = d3.svg.axis().scale(xScale4).orient("bottom").ticks(0);
var yAxis = d3.svg.axis().scale(yScale4).orient("left").ticks(0);
svg3.append("g").attr("transform", "translate(0," + (height3 - yPadding3) + ")").attr("class", "axis")
.call(xAxis);
svg3.append("g").attr("transform", "translate(" + width3/2 + ",0)").attr("class", "axis")
.call(yAxis);
var color3 =d3.scale.linear().domain([-150,150]).range(["red","green"]);

//Population in the data?
//Drug data : General Prevalence - Cannabis
//Annual Prevalence of Use as a percentage of the population aged 15-64
//From https://data.unodc.org/
d3.json("cannabis.json", function(error, cannabisJSON){
	cannabisUsage = cannabisJSON;
	if(error){console.log(error); }
        var rScale = d3.scale.pow()
            .domain([-30, 30])
            .range([0, 20]);
        for(var i = 0; i<1000;i++){
        	try{
				name = getCountryName(i);
				gdp = getGdpRank(name);
				happiness = getRank(name);
				optimism = happiness - gdp;
				cannabis = getCannabisUsage(name);
				if(gdp == 0 || happiness == 0 || cannabis == 0)
					continue;
        		svg3.append("circle")
       	 		.attr("class", "circle")
        		.attr("cx",xScale4(optimism))
        		.attr("cy", yScale4(cannabis))
        		.attr("r", rScale(30))
        		.style("fill", (color3(optimism)))
        		.style("fill-opacity", 0.4);
				}
			catch(err){
				console.log(err.message);
			}
        	
       }
});
</script>

</body>
</html>
