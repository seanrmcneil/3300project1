<html>
<head>
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="style.css">
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

</head>
<body>

<div id="map"></div>

<script>
//graph 1 ~ happiness
var width = 960,
    height = 500;
var projection = d3.geo.equirectangular();
var path = d3.geo.path().projection(projection);
var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);
var g = svg.append("g");
var worldObjects;
var countryIDName;
var happinessRank;
//get the id mappings json file
d3.json("id_mapping.json", function(dataID) {
	countryIDName = dataID;
	});
//get the happiness rankings
d3.json("happiness.json", function(happiness) {
	happinessRank = happiness;
	});
//function to return the name of the country based on the id.
function getCountryName(countryid){
	for(var i =0; i<countryIDName.length; i++ ){
		if(countryIDName[i].id == countryid){
			return countryIDName[i].name;
		}
	}
}
//function to return the id of the country based on the name
//Only used for debugging as of now
function getCountryID(countryName){
	for(var i =0; i<countryIDName.length; i++ ){
		if(countryIDName[i].name == countryName){
			return countryIDName[i].id;
		}
	}
}
//function to get the rank of the country basd on the country name
function getRank(countryName){
	var rank = 0;
	for(var i =0; i<happinessRank.length; i++ ){
		if(happinessRank[i].val1 == countryName){
			rank = happinessRank[i].val0;
		}
	}
	return rank;
}
//functions to convert colors based on country ranking
//make sure all functions return 0 (black) if the rank is 0 (undefined)
//maybe change from black to grey? Black is ugly
function red(rank) {
	if(rank==0){
		return 238;
	}else{
		return Math.round(255*(255*rank)/151);
	}
};
function green(rank){ 
	if (rank == 0){
		return 233;
	}else{
		return  Math.round((255*(151-rank))/151)};
	}
function blue(rank) {
	if (rank ==0 ){
		return 233;
	}else{
		return Math.round(0)
	}
};
var countryName = "";
//the magic
d3.json("world-50m.json", function(error, world) {
	worldObjects = world;
	if(error){console.log(error); }
	var countries = topojson.feature(world,world.objects.countries).features;
	countries.forEach(function (country) {
		countryName = getCountryName(country.id);
		rank = getRank(countryName);
		g.append("path").attr("d", path(country))
		.attr("class", "country")
		.style("fill", "rgb("+red(rank) +","+green(rank)+","+blue(rank)+")")
		;
	});
	//using for debugging purposes.. 
	//take out later
	g.selectAll("path").data(countries).on("mouseover", function(country){
		console.log(getCountryName(country.id));
	})
});
console.log("after json");

</script>

<script>
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
</script>


<div id="map2"></div>

<script>
//graph 2 ~ GDP
var width2 = 960,
    height2 = 500;
var projection2 = d3.geo.equirectangular();
var path2 = d3.geo.path().projection(projection2);
var svg2 = d3.select("#map2").append("svg")
    .attr("width", width2)
    .attr("height", height2);
var g2 = svg2.append("g");
var worldObjects2;
var gdpRank;


//get te gdp rankings
d3.json("gdp.json", function(gdp) {
	gdpRank = gdp;
})


//function to get the rank of the country basd on the country name
function getGdpRank(countryName){
	var rank = 0;
	for(var i =0; i<gdpRank.length; i++ ){
		if(gdpRank[i].val0 == countryName){
			rank = gdpRank[i].val1;
		}
	}
	return rank;
}

var countryName = "";
//the magic
d3.json("world-50m.json", function(error, world) {
	worldObjects2 = world;
	if(error){console.log(error); }
	var countries2 = topojson.feature(world,world.objects.countries).features;
	countries2.forEach(function (country) {
		countryName = getCountryName(country.id);
		rank2 = getGdpRank(countryName);
		g2.append("path").attr("d", path2(country))
		.attr("class", "country")
		.style("fill", "rgb("+red(rank2) +","+green(rank2)+","+blue(rank2)+")")
		;
	});
	//using for debugging purposes.. 
	//take out later
	g2.selectAll("path").data(countries2).on("mouseover", function(country){
		console.log(getCountryName(country.id));
	})
});
 </script>

<div id="scatterplot"></div>
<script>
//scatterplot : drug use of optimistic countries and pessimistic countries
var width3 = 500,
    height3 = 500,
    padding = 60;
var svg3 = d3.select("#scatterplot").append("svg")
    .attr("width", width3)
    .attr("height", height3)
    .append("g");

//X axis for how drugged they are
//Y axis for optimism. Above 0 : opimitistic. Below 0 : pessimistic
var xScale = d3.scale.linear().domain([1,200]).range([padding, width3 - padding]);
var yScale = d3.scale.linear().domain([-150,150]).range([height3 - padding, padding]);
var xAxis = d3.svg.axis().scale(xScale).orient("bottom").ticks(0);
var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(0);
svg3.append("g").attr("transform", "translate(0," + height/2  + ")").attr("class", "axis")
.call(xAxis);
svg3.append("g").attr("transform", "translate(" + padding + ",0)").attr("class", "axis")
.call(yAxis);



var optimismData;
//Need to have happiness and gdp together to generate difference
//TODO : find some script/some way to merge/join JSON files.. or manually input
//Population in the data?
var combinedJSON = {}
// optimism.json just for temporary use
d3.json("optimism.json", function(error, json){
	//TODO : add all the data
	//TODO : maybe transparent circles?
	//
	if(error){console.log(error); }
        var rScale = d3.scale.pow()
            .domain([-30, 30])
            .range([0, 20]);
        for(var i = 0; i<json.length;i++){        	
        	 svg3.append("circle")
        	.attr("class", "circle")
        	.attr("cx",xScale(json[i].drug))
        	.attr("cy", yScale(json[i].opt))
        	.attr("r", rScale(json[i].population))
        	//color is opposite of what it should be
        	//TODO : change color to suit
        	.style("fill", "rgb("+red(json[i].opt) +","+green(json[i].opt)+","+blue(json[i].opt)+")")
        	.style("fill-opacity", 0.4);
        }
});
//Some thoughts : some kind of visualization towards the right would be great.
//Cannabis leaves maybe?

</script>







</body>
</html>
