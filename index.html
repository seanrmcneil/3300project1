<html>
<head>
<link href='https://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="style.css">
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

</head>
<body>
<div class="graph">
<h2>Happiness</h2>
<div id="map"></div>

<script>
//graph 1 ~ happiness
var width = 960,
    height = 500;
var projection = d3.geo.equirectangular();
var path = d3.geo.path().projection(projection);
var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);
var g = svg.append("g");
var worldObjects;
var countryIDName;
var happinessRank;
var color1 =d3.scale.linear().domain([1,151]).range(["#8856a7","white"]);
var color2 =d3.scale.linear().domain([1,208]).range(["#6AAF6A","white"]);
//get the id mappings json file
d3.json("id_mapping.json", function(dataID) {
	countryIDName = dataID;
	});

//get the happiness data
d3.json("happiness_final.json", function(happiness) {
	happinessRank = happiness;
	});

//get te gdp data
d3.json("GDP_final.json", function(gdp) {
	gdpRank = gdp;
})

//function to return the name of the country based on the id.
function getCountryName(countryid){
	for(var i =0; i<countryIDName.length; i++ ){
		if(countryIDName[i].id == countryid){
			return countryIDName[i].name;
		}
	}
}
//function to return the id of the country based on the name
//Only used for debugging as of now
function getCountryID(countryName){
	for(var i =0; i<countryIDName.length; i++ ){
		if(countryIDName[i].name == countryName){
			return countryIDName[i].id;
		}
	}
}
//function to get the rank of the country basd on the country name
function getRank(countryName){
	var rank = 0;
	for(var i =0; i<happinessRank.length; i++ ){
		if(happinessRank[i].country_name == countryName){
			rank = happinessRank[i].rank;
		}
	}
	return rank;
}
//function to define the color
function getColorMap1(rank){
	if(rank ==0){
		return "grey";
	}else{
		return color1(rank);}
}
//functiion to define the color
function getColorMap2(rank){
	if(rank ==0){
		return "grey";
	}else{
		return color2(rank);
	  }
}
//function to get the rank of the country basd on the country name
function getGdpRank(countryName){
	var rank = 0;
	for(var i =0; i<gdpRank.length; i++ ){
		if(gdpRank[i].country_name == countryName){
			rank = gdpRank[i].rank;
		}
	}
	return rank;
}
function getGDPValue(countryName){
	var value = 0;
	for(var i =0; i<gdpFinal.length; i++ ){
		if((gdpFinal[i].country_name) == countryName){
			value = gdpFinal[i].gdp;
		}
	}
	return value;
}
function getHappinessValue(countryName){
	var value = 0;
	for(var i =0; i<happinessFinal.length; i++ ){
		if(happinessFinal[i].country_name == countryName){
			value = happinessFinal[i].HPI;
		}
	}
	return value;
}
function getCannabisUsage(countryName){
	var usage = 0;
	for(var i =0; i<200; i++ ){
		if(cannabisUsage[i].val0 == countryName){
			usage = cannabisUsage[i].val1;
		}
	}
	return usage;
}

var countryName = "";
//the magic
d3.json("world-50m.json", function(error, world) {
	worldObjects = world;
	if(error){console.log(error); }
	var countries = topojson.feature(world,world.objects.countries).features;
	countries.forEach(function (country) {
		countryName = getCountryName(country.id);
		rank = getRank(countryName);
		g.append("path").attr("d", path(country))
		.attr("class", "country")
		.style("fill", (getColorMap1(rank)))
		;
	});
	//using for debugging purposes.. 
	//take out later
	g.selectAll("path").data(countries).on("mouseover", function(country){
		console.log(getCountryName(country.id));
	})
});
console.log("after json");

</script>
</div>
<script>
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
</script>

<div class="graph">
<h2>GDP</h2>
<div id="map2"></div>

<script>
//graph 2 ~ GDP
var width2 = 960,
    height2 = 500;
var projection2 = d3.geo.equirectangular();
var path2 = d3.geo.path().projection(projection2);
var svg2 = d3.select("#map2").append("svg")
    .attr("width", width2)
    .attr("height", height2);
var g2 = svg2.append("g");
var worldObjects2;
var gdpRank;



//countryName = "";
//the magic
d3.json("world-50m.json", function(error, world) {
	worldObjects2 = world;
	if(error){console.log(error); }
	var countries2 = topojson.feature(world,world.objects.countries).features;
	countries2.forEach(function (country) {
		countryName = getCountryName(country.id);
		rank2 = getGdpRank(countryName);
		g2.append("path").attr("d", path2(country))
		.attr("class", "country")
		.style("fill", getColorMap2(rank2));
	});
	//using for debugging purposes.. 
	//take out later
	g2.selectAll("path").data(countries2).on("mouseover", function(country){
		console.log(getCountryName(country.id));
	})
});
 </script>
</div>
<div class="graph">
<h2>GDP vs Happiness</h2>
 <div id = "graph"> </div>

<script>

var widthGraph = 1200,
	heightGraph = 960,
	xPaddingGraph = 50,
	yPaddingGraph = 50;
var gdpFinal;
var happinessFinal;




var svgGraph = d3.select("#graph").append("svg")
    .attr("width", widthGraph)
    .attr("height", heightGraph)
    .append("g");
var xScaleGraph = d3.scale.log().domain([150, 130000]).range([xPaddingGraph, widthGraph - xPaddingGraph]);
var yScaleGraph = d3.scale.linear().domain([10, 50]).range([heightGraph - yPaddingGraph, yPaddingGraph]);
var xAxis = d3.svg.axis().scale(xScaleGraph).orient("bottom").ticks(0);
var yAxis = d3.svg.axis().scale(yScaleGraph).orient("left").ticks(0);
svgGraph.append("g").attr("transform", "translate(0," + (heightGraph - yPaddingGraph) + ")")
.call(xAxis);
svgGraph.append("g").attr("transform", "translate(" + xPaddingGraph + ",0)")
.call(yAxis);


var rScale = d3.scale.pow()
            .domain([-30, 30])
            .range([0, 20]);

d3.json("happiness_final.json", function(error, happinessFinalJSON){
	happinessFinal = happinessFinalJSON;
		if(error){console.log(error); }
});



d3.json("GDP_final.json", function(error, gdpFinalJSON){
		if(error){console.log(error); }
		gdpFinal = gdpFinalJSON;
        for(var i = 0; i<1000;i++){
				name = getCountryName(i);
				gdp = getGDPValue(name);
				happiness = getHappinessValue(name);
				if(gdp == 0 || happiness == 0)
					continue;
				//region
				
        		svgGraph.append("circle")
       	 		.attr("class", "circle")
        		.attr("cx",xScaleGraph(gdp))
        		.attr("cy", yScaleGraph(happiness))
        		.attr("r", 20)
        		.style("fill", "red")
        		.style("fill-opacity", 0.4);
			}
		});


</script>
</div>
<div class="graph">
<h2>Drug Use vs. Optimism</h2>
<div id="scatterplot"></div>
<script>
//scatterplot : drug use of optimistic countries and pessimistic countries
var width3 = 1000,
    height3 = 700,
    xPadding3 = 60,
    yPadding3 = 50;
var svg3 = d3.select("#scatterplot").append("svg")
    .attr("width", width3)
    .attr("height", height3)
    .append("g");
var cannabisUsage;



//Y axis for how drugged they are
//X axis for optimism. Above 0 : opimitistic. Below 0 : pessimistic
var xScale4 = d3.scale.linear().domain([-150,150]).range([xPadding3, width3 - xPadding3]);
var yScale4 = d3.scale.linear().domain([0,20]).range([height3 - yPadding3, yPadding3]);
var xAxis = d3.svg.axis().scale(xScale4).orient("bottom").ticks(0);
var yAxis = d3.svg.axis().scale(yScale4).orient("left").ticks(0);
svg3.append("g").attr("transform", "translate(0," + (height3 - yPadding3) + ")").attr("class", "axis")
.call(xAxis);
svg3.append("g").attr("transform", "translate(" + width3/2 + ",0)").attr("class", "axis")
.call(yAxis);
var color3 =d3.scale.linear().domain([-150,150]).range(["red","green"]);

//Population in the data?
//Drug data : General Prevalence - Cannabis
//Annual Prevalence of Use as a percentage of the population aged 15-64
//From https://data.unodc.org/
d3.json("cannabis.json", function(error, cannabisJSON){
	cannabisUsage = cannabisJSON;
	if(error){console.log(error); }
        var rScale = d3.scale.pow()
            .domain([-30, 30])
            .range([0, 20]);
        for(var i = 0; i<1000;i++){
        	try{
				name = getCountryName(i);
				gdp = getGdpRank(name);
				happiness = getRank(name);
				optimism = happiness - gdp;
				cannabis = getCannabisUsage(name);
				if(gdp == 0 || happiness == 0 || cannabis == 0)
					continue;
        		svg3.append("circle")
       	 		.attr("class", "circle")
        		.attr("cx",xScale4(optimism))
        		.attr("cy", yScale4(cannabis))
        		.attr("r", rScale(30))
        		.style("fill", (color3(optimism)))
        		.style("fill-opacity", 0.4);
				}
			catch(err){
				console.log(err.message);
			}
        	
       }
});
</script>
</div>
</body>
</html>
